<!doctype html>
<head>
    <title>Testing jQuery XML Parsing</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <style>
        h2 {color: #444; font-family: Arial, Helvetica, sans-serif; margin-bottom: .2em;}
        #input-pane, #preview-pane {float: left; margin-right: 1em; width: 48%;}
        #preview-pane #staging-area {background-color: #eee; border: 1px solid #ddd; padding: 1em;}
        textarea, #staging-area {height: 300px; overflow: auto; width: 100%;}
        #preview-pane label {clear: both; display: block;}
        #preview-pane label input {float: left; margin-right: 1em;}
        #preview-pane #staging-area p {clear: both; display: block; padding: 0 0 1em;}
    </style>
</head>
<body>
<div id="input-pane">
    <h2>Enter Problem XML</h2>
    <textarea>
    <problem>
    <p>
    A multiple choice problem presents radio buttons for student
    input. Students can only select a single option presented. Multiple Choice questions have been the subject of many areas of research due to the early invention and adoption of bubble sheets.</p>
    <p> One of the main elements that goes into a good multiple choice question is the existence of good distractors. That is, each of the alternate responses presented to the student should be the result of a plausible mistake that a student might make. 
    </p>

    <p>What Apple device competed with the portable CD player?</p>
        <multiplechoiceresponse>
         <choicegroup type="MultipleChoice">
            <choice correct="false" name="ipad">The iPad</choice>
            <choice correct="false" name="beatles">Napster</choice>
            <choice correct="true" name="ipod">The iPod</choice>
            <choice correct="false" name="peeler">The vegetable peeler</choice>
            <choice correct="false" name="android">Android</choice>
            <choice correct="false" name="beatles">The Beatles</choice>
         </choicegroup>
        </multiplechoiceresponse>
        <solution>
            <div class="detailed-solution">
                <p>Explanation</p>
                <p>The release of the iPod allowed consumers to carry their entire music library with them in a format that did not rely on fragile and enery-intensive spinning disks. </p>
            </div>
        </solution>
    </problem>

    </textarea>
    <input type="button" id="preview-btn" value="Preview My Problem" />
</div>

<div id="preview-pane">
    <h2>Preview Problem HTML</h2>
    <div id="staging-area">
    </div>
</div>
</body>
<script>

$(document).ready(function () {

    var questionIdx = 0;

    function renderPreview() {

        $('#staging-area').empty();

        // Set up XML DOM
        var sourceXML = $('textarea').val();
        try {
            var myDOM = $.parseXML(sourceXML);
        } catch (e) {
            alert('Your XML is invalid');
            console.log(e.message);
            return;
        }
        var root = $(myDOM).find('problem');
        var allChildren = $(root).children();

        $(allChildren).each(function () {
            if ($(this)[0].nodeName == 'p') {
                $(this).clone().appendTo($('#staging-area'));
            } else if ($(this)[0].nodeName == 'multiplechoiceresponse') {
                var choices = $($(this)).find('choice'); 
                
                $(choices).each(function (idx, el) {
                    var tmpInput = document.createElement('input');
                    var tmpLabel = document.createElement('label');
                    $(tmpLabel).attr('for', 'q' + questionIdx + '_' + idx);

                    $(tmpInput).attr('type', 'radio');
                    $(tmpInput).attr('id', 'q' + questionIdx + '_' + idx);
                    $(tmpInput).attr('name', 'q' + questionIdx);
                    $(tmpInput).attr('value', $(this).attr('name'));

                    $(tmpLabel).text($(this).text());

                    $('#staging-area').append($(tmpLabel));
                    $(tmpLabel).append($(tmpInput));
                });
            }
        });
       
        var dataToTransmit = {};
        dataToTransmit.xmlContent = $('textarea').val();
        dataToTransmit.htmlContent = $('#staging-area').html(); 
        console.log(JSON.stringify(dataToTransmit));

    }

    $('#preview-btn').click(renderPreview);
});

</script>
</html>
